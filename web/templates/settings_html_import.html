{% extends "base.html" %}
{% set title = "HTML invoice import — Remind & Pay" %}
{% block content %}
<link rel="stylesheet" href="/static/css/settings.css">

<h1>Settings</h1>

<nav id="set_tabs" class="tabbar" style="margin:0 0 12px 0;">
  <button class="tab" data-tab="app">App settings</button>
  <button class="tab" data-tab="email">Email settings</button>
  <button class="tab is-active" data-tab="import">Invoice import</button>
  <button class="tab" data-tab="restore">Restore defaults</button>
  <div style="flex:1"></div>
</nav>

<section class="panel panel--wide" style="margin-top:12px;">
  <div class="panel__head">
    <h2>Invoice import settings</h2>

    <nav id="ii_subtabs" class="tabbar" style="margin-top:8px;">
      <button class="tab" data-subtab="settings">Settings</button>
      <button class="tab" data-subtab="pdf">PDF invoices</button>
      <button class="tab is-active" data-subtab="html">HTML invoices</button>
    </nav>
  </div>

  <div class="content" style="padding:12px;">
    <div style="display:grid; grid-template-columns:260px 320px 1fr; gap:16px; align-items:flex-start;">

      <!-- LEFT COLUMN: template list + create -->
      <div class="subpanel" style="padding:12px;">
        <div style="margin-bottom:8px;">
          <div style="font-weight:600;">HTML templates</div>
          <div class="muted" style="font-size:12px;">Step 1: create or select a template.</div>
        </div>

        <div class="field" style="margin-bottom:8px;">
          <label for="html_template_name" style="display:block; font-weight:500; font-size:13px; margin-bottom:4px;">
            Template name
          </label>
          <input id="html_template_name" type="text" placeholder="e.g. HTML invoice template" style="height:32px; padding:0 8px; width:100%;">
        </div>

        <button id="html_template_create" class="btn" type="button" style="width:100%; margin-bottom:10px;">
          Create template
        </button>

        <div class="field">
          <label for="html_template_selector" style="display:block; font-weight:500; font-size:13px; margin-bottom:4px;">
            Saved templates
          </label>
          <select id="html_template_selector" style="height:32px; padding:0 8px; width:100%;">
            <option value="">(choose template)</option>
          </select>
          <div class="muted" style="font-size:12px; margin-top:4px;">Select a template to load its saved HTML sample.</div>
        </div>
      </div>

      <!-- MIDDLE COLUMN: mapping steps -->
      <div class="subpanel" style="padding:12px;">
        <div style="font-weight:600; margin-bottom:8px;">HTML mapping steps</div>
        <div class="subpanel" style="padding:12px; margin-bottom:10px;">
          <div style="font-weight:600;">Step 1 — Choose field</div>
          <div class="muted" style="margin-top:4px; font-size:12px;">Select which invoice field you want to map.</div>
        </div>
        <div class="subpanel" style="padding:12px; margin-bottom:10px;">
          <div style="font-weight:600;">Step 2 — Pick target</div>
          <div class="muted" style="margin-top:4px; font-size:12px;">Choose where that value should be stored.</div>
        </div>
        <div class="subpanel" style="padding:12px;">
          <div style="font-weight:600;">Step 3 — Locate value</div>
          <div class="muted" style="margin-top:4px; font-size:12px;">Identify the value in the HTML content.</div>
        </div>
      </div>

      <!-- RIGHT COLUMN: HTML sample + preview -->
      <div class="subpanel" style="padding:12px;">
        <div style="font-weight:600; margin-bottom:8px;">HTML sample</div>
        <div class="muted" style="font-size:12px; margin-bottom:8px;">Step 2: paste the HTML email body and save it to the template.</div>
        <textarea
          id="html_invoice_body"
          rows="12"
          placeholder="Paste HTML email body here..."
          style="width:100%; padding:10px; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace; min-height:220px;"
        ></textarea>
        <div class="field-row" style="gap:8px; align-items:center; margin-top:8px;">
          <button id="html_invoice_save" class="btn" type="button" disabled>Save HTML sample</button>
          <span id="html_invoice_msg" class="muted" style="font-size:12px;"></span>
        </div>
        <div class="muted" style="font-size:12px; margin-top:12px;">Preview (coming next): the HTML will render here for selection.</div>
        <div style="border:1px solid #e5e7eb; border-radius:8px; padding:10px; margin-top:6px; background:#fff; min-height:200px;">
          <div class="muted" style="font-size:12px;">HTML preview placeholder</div>
        </div>
      </div>
    </div>
  </div>
</section>

<script>
  (function(){
    const tabs = document.getElementById('set_tabs');
    if (!tabs) return;

    tabs.addEventListener('click', (e)=>{
      const btn = e.target.closest('.tab');
      if (!btn) return;
      const which = btn.dataset.tab;

      if (which === 'import') {
        return;
      } else if (which === 'app') {
        window.location.href = '/settings';
      } else if (which === 'email') {
        window.location.href = '/settings';
      } else if (which === 'restore') {
        window.location.href = '/settings';
      }
    });
  })();
</script>

<script src="/static/js/settings_html_import.js"></script>

<script>
  (function () {
    const bar = document.getElementById('ii_subtabs');
    if (!bar) return;

    bar.addEventListener('click', function (e) {
      const btn = e.target.closest('.tab');
      if (!btn) return;
      const which = btn.dataset.subtab;
      if (!which) return;

      if (which === 'settings') {
        window.location.href = '/settings/invoice-import';
        return;
      }

      if (which === 'pdf') {
        window.location.href = '/settings/invoice-import';
        return;
      }

      if (which === 'html') {
        return;
      }
    });
  })();
</script>

{% endblock %}
